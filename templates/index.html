<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgriNova Dashboard</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-1: #0f172a;
      --bg-2: #152238;
      --text: #e6f1ff;
      --accent: #00ffc3;
      --accent-2: #8dffb6;
      --glass-bg: rgba(255, 255, 255, 0.06);
      --glass-brd: rgba(255, 255, 255, 0.12);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at 30% -10%, var(--bg-2), var(--bg-1) 60%);
      font-family: 'Poppins', sans-serif;
      color: var(--text);
      overflow-x: hidden;
    }

    /* Falling Leaves */
    .leaf {
      position: fixed;
      top: -12vh;
      left: 0;
      opacity: var(--opacity, .9);
      font-size: var(--size, 28px);
      pointer-events: none;
      filter: drop-shadow(0 0 10px currentColor) blur(1px);
      z-index: 0;
      animation: fall var(--dur, 9s) linear var(--delay, 0s) forwards;
      transform: translate3d(var(--x, 50vw), -12vh, 0) rotate(var(--rotStart, 0deg));
    }

    @keyframes fall {
      0% {
        transform: translate3d(var(--x), -12vh, 0) rotate(var(--rotStart));
        opacity: 0;
      }

      10% {
        opacity: var(--opacity, .9);
      }

      100% {
        transform: translate3d(calc(var(--x) + var(--drift, 20vw)), 110vh, 0) rotate(var(--rotEnd, 360deg));
        opacity: 0;
      }
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(15, 23, 42, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .modal-content {
      background: rgba(24, 39, 66, 0.95);
      padding: 30px 35px;
      border-radius: 15px;
      max-width: 400px;
      width: 90vw;
      color: #e6f1ff;
      box-sizing: border-box;
    }

    .modal-content h2 {
      margin-top: 0;
      color: #00ffc3;
      font-weight: 700;
      text-align: center;
    }

    .modal-content label {
      font-weight: 600;
      color: #b0bec5;
      margin-top: 16px;
      display: block;
    }

    .modal-content input {
      width: 100%;
      padding: 12px 14px;
      margin-top: 6px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      outline: none;
      box-sizing: border-box;
      background: rgba(255, 255, 255, 0.1);
      color: #e6f1ff;
    }

    .modal-content button {
      margin-top: 20px;
      background: #00c2a0;
      border: none;
      padding: 14px 0;
      cursor: pointer;
      font-weight: 700;
      border-radius: 10px;
      color: white;
      font-size: 1rem;
      width: 100%;
      transition: background-color 0.3s ease;
    }

    .modal-content button:hover {
      background: #009d82;
    }

    .login-alert {
      background: #ffd2d2;
      color: #a94442;
      padding: 12px 15px;
      font-weight: 600;
      border-radius: 8px;
      margin: 14px 0 0;
      text-align: center;
      font-size: 1rem;
      box-sizing: border-box;
      display: none;
      user-select: none;
    }

    /* NAVBAR */
    .navbar {
      position: sticky;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(15, 23, 42, 0.352);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      padding: 14px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo img {
      height: 42px;
    }

    .logo span {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(90deg, #00ffc3, #a8ff60);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 16px rgba(0, 255, 195, 0.4);
    }

    .nav-links {
      display: flex;
      gap: 80px;
    }

    .nav-links a {
      text-decoration: none;
      font-weight: 600;
      color: var(--text);
      transition: color .3s ease;
    }

    .nav-links a:hover {
      color: var(--accent);
    }

    /* Hamburger */
    .hamburger {
      display: none;
      flex-direction: column;
      cursor: pointer;
      gap: 5px;
    }

    .hamburger span {
      width: 24px;
      height: 3px;
      background: var(--text);
      border-radius: 2px;
      transition: all 0.4s ease;
    }

    /* Mobile menu */
    .mobile-menu {
      position: fixed;
      top: 60px;
      right: -100%;
      background: rgba(15, 23, 42, 0.356);
      backdrop-filter: blur(10px);
      width: 200px;
      padding: 20px;
      border-radius: 12px 0 0 12px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      transition: right 0.4s ease;
      z-index: 999;
    }

    .mobile-menu.open {
      right: 0;
    }

    .mobile-menu a {
      color: var(--text);
      text-decoration: none;
      font-weight: 600;
    }

    .mobile-menu a:hover {
      color: var(--accent);
    }

    @media (max-width: 768px) {
      .nav-links {
        display: none;
      }

      .hamburger {
        display: flex;
      }
    }

    /* CONTAINER */
    .container {
      position: relative;
      z-index: 2;
      padding: 30px 20px 120px;
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
    }

    .welcome-box {
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      border-radius: 18px;
      padding: 24px;
      margin: 0 auto 36px;
      max-width: 820px;
      color: #c9dbff;
      backdrop-filter: blur(12px);
    }

    .welcome-box h2 {
      margin: 0 0 8px;
      font-size: 2rem;
      font-weight: 900;
      background: linear-gradient(90deg, #b4e1f3, #3c9ef4, #40c9ff, #4facfe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 4s infinite linear;
      background-size: 300% 300%;
    }

    /* DASHBOARD GRID */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 28px;
      margin-bottom: 40px;
    }

    .card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      border-radius: 16px;
      padding: 22px;
      transition: transform .3s, box-shadow .3s, border-color .3s;
      backdrop-filter: blur(10px);
    }

    .card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 10px 40px rgba(0, 255, 195, 0.18);
      border-color: rgba(0, 255, 195, 0.35);
    }

    .card h3 {
      margin: 0 0 8px;
      font-size: 1.2rem;
      color: var(--accent);
    }

    /* Tank */
    .tank {
      margin: 0 auto 28px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      border-radius: 16px;
      width: 340px;
      padding: 20px;
      backdrop-filter: blur(10px);
    }

    .tank p {
      margin: 0;
      font-weight: 600;
      font-size: 1.05rem;
    }

    /* WATER MGMT */
    .water-management {
      margin-top: 40px;
    }

    .water-management h2 {
      font-size: 1.4rem;
      margin-bottom: 18px;
      background: linear-gradient(90deg, #b3ffe2, #9ef5ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }

    .btn {
      background: linear-gradient(135deg, #00ffc3, #00c2a0);
      border: none;
      padding: 14px 26px;
      border-radius: 12px;
      color: #0b1324;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 14px rgba(0, 255, 195, 0.34);
      transition: transform .25s, box-shadow .25s;
      width: 180px;
      height: 55px;
      text-align: center;
    }

    .btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 0 24px rgba(0, 255, 195, 0.55);
    }
  </style>

</head>

<body>
  <!-- NAVBAR -->
  <!-- Login modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <h2>Login Required</h2>
      <div class="login-alert" id="loginAlert" style="display:none;">Login failed. Please try again.</div>
      <form id="loginForm" novalidate>
        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="your@example.com" required />

        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />

        <button type="submit">Sign In</button>
      </form>
    </div>
  </div>

  <!-- Your dashboard content below -->
  <div id="dashboardContent" style="display:none;">
    <!-- Your existing dashboard markup -->
  </div>

  <div class="navbar">
    <div class="header">
      <div class="logo">
        <img src="static/logo.png" alt="AgriNova Logo" />
      </div>
    </div>
    <div class="nav-links">
      <a href="#">Home</a>
      <a href="{{ url_for('weather') }}">Weather</a>
      <a href="{{ url_for('leaf') }}">Leaf analyzer AI</a>
      <a href="{{ url_for('chat') }}">Chat</a>
      <!-- <a href="#">Settings</a>
      <a href="signup.html">Sign up</a> -->
    </div>
    <div class="hamburger" onclick="toggleMenu(this)">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <a href="#">Home</a>
    <a href="{{ url_for('weather') }}">Weather</a>
    <a href="{{ url_for('leaf') }}">Leaf analyzer AI</a>
    <a href="{{ url_for('chat') }}">Chat</a>
    <!-- <a href="#">Settings</a>
    <a href="signup.html">Sign up</a> -->
  </div>

  <div class="container">
    <div class="welcome-box">
      <h2>Welcome!</h2>
      <p>‚ÄúAgriNova empowers farmers with smart, sustainable agriculture monitoring.‚Äù</p>
    </div>

    <div class="dashboard">
      <div class="card">
        <h3>Soil Moisture</h3>
        <p id="soilMoistureInput">--</p>
      </div>
      <div class="card">
        <h3>Temperature</h3>
        <p id="tempValue">--</p>
      </div>
      <div class="card">
        <h3>Humidity</h3>
        <p id="humidValue">--</p>
      </div>
      <div class="card">
        <h3>Water Level</h3>
        <p id="waterLevelInput">--</p>
      </div>
    </div>

    <div class="tank">
      <p>Tank Height:</p>
      <p id="tankHeightInput">Loading...</p>
    </div>

    <div class="water-management">
      <h2>‚öôÔ∏è Water Management</h2>
      <div class="buttons">
        <button class="btn" id="drainBtn">Drain Water</button>
        <button class="btn" id="distributeBtn">Distribute Water</button>
      </div>
      <p id="pump1Status"></p>
      <p id="pump2Status"></p>
    </div>

    <div id="tempMessage" style="display:none; padding:10px; margin-top:20px; border-radius:8px; font-weight:600;">
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <!-- Falling Leaves + Menu -->
  <script>

    const loginModal = document.getElementById('loginModal');
    const loginForm = document.getElementById('loginForm');
    const loginAlert = document.getElementById('loginAlert');
    const dashboardContent = document.getElementById('dashboardContent');

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = loginForm.email.value.trim();
      const password = loginForm.password.value;

      if (email === 'srinjoyt06@gmail.com' && password === '00') {
        loginAlert.style.display = 'none';
        loginModal.style.display = 'none';
        dashboardContent.style.display = 'block';
      } else {
        loginAlert.style.display = 'block';
      }
    });

    function createLeaf() {
      const el = document.createElement('i');
      el.className = 'fa-solid fa-leaf leaf';
      const vw = Math.random() * 100;
      const drift = (Math.random() * 30 - 15) + 'vw';
      const size = (18 + Math.random() * 28) + 'px';
      const dur = (8 + Math.random() * 8) + 's';
      const delay = (Math.random() * 2) + 's';
      const rotStart = (Math.random() * 360) + 'deg';
      const rotEnd = (360 + Math.random() * 540) + 'deg';
      const opacity = (0.7 + Math.random() * 0.3).toFixed(2);
      const colors = ['#00ffc3', '#8dffb6', '#7ee7ff'];
      el.style.color = colors[Math.floor(Math.random() * colors.length)];
      el.style.setProperty('--x', vw + 'vw');
      el.style.setProperty('--drift', drift);
      el.style.setProperty('--size', size);
      el.style.setProperty('--dur', dur);
      el.style.setProperty('--delay', delay);
      el.style.setProperty('--rotStart', rotStart);
      el.style.setProperty('--rotEnd', rotEnd);
      el.style.setProperty('--opacity', opacity);
      document.body.appendChild(el);
      el.addEventListener('animationend', () => el.remove());
    }
    setInterval(createLeaf, 300);

    function toggleMenu(x) {
      x.classList.toggle("active");
      document.getElementById("mobileMenu").classList.toggle("open");
    }
  </script>

  <script>
    function toggleMenu(x) {
      x.classList.toggle("active");
      document.getElementById("mobileMenu").classList.toggle("open");
    }

    (function () {
      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyCII_qpWN7Xj0-qEYtIIQNzDmDoObywHoI",
        authDomain: "ledblink-f184b.firebaseapp.com",
        databaseURL: "https://ledblink-f184b-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "ledblink-f184b",
        storageBucket: "ledblink-f184b.appspot.com",
        messagingSenderId: "830272383259",
        appId: "1:830272383259:android:182017adc731aa69994bbe"
      };

      const $ = id => document.getElementById(id);

      let messageTimeout = null;
      function showTemporaryMessage(msg, options = {}) {
        const tempBox = $("tempMessage");
        if (!tempBox) return;

        tempBox.innerText = msg;
        tempBox.style.display = "block";
        tempBox.style.background = options.background || "#b00020";
        tempBox.style.color = options.color || "white";

        if (messageTimeout) clearTimeout(messageTimeout);
        messageTimeout = setTimeout(() => {
          tempBox.style.display = "none";
        }, options.duration || 3000);
      }

      window.addEventListener("DOMContentLoaded", () => {
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let pump1State = false;
        let pump2State = false;

        function updatePumpStatusUI() {
          if ($("pump1Status")) {
            $("pump1Status").innerText = pump1State ? "üö∞ Drain Water is ON" : "";
            $("pump1Status").style.background = pump1State ? "#00FF88" : "transparent";
            $("pump1Status").style.color = pump1State ? "white" : "#000";
          }
          if ($("pump2Status")) {
            $("pump2Status").innerText = pump2State ? "üíß Distribute Water is ON" : "";
            $("pump2Status").style.background = pump2State ? "#00FF88" : "transparent";
            $("pump2Status").style.color = pump2State ? "white" : "#000";
          }
        }

        database.ref("controls/pump1").on("value", snapshot => {
          pump1State = !!snapshot.val();
          updatePumpStatusUI();
        });

        database.ref("controls/pump2").on("value", snapshot => {
          pump2State = !!snapshot.val();
          updatePumpStatusUI();
        });

        function togglePump1() {
          pump1State = !pump1State;
          database.ref("controls/pump1").set(pump1State)
            .then(() => {
              updatePumpStatusUI();
              if (!pump1State) showTemporaryMessage("üö∞ Drain Water is OFF", { background: "#FF4D4D" });
            })
            .catch(err => console.error("Failed to update pump1:", err));
        }

        function togglePump2() {
          pump2State = !pump2State;
          database.ref("controls/pump2").set(pump2State)
            .then(() => {
              updatePumpStatusUI();
              if (!pump2State) showTemporaryMessage("üíß Distribute Water is OFF", { background: "#FF4D4D" });
            })
            .catch(err => console.error("Failed to update pump2:", err));
        }

        if ($("drainBtn")) $("drainBtn").addEventListener("click", togglePump1);
        if ($("distributeBtn")) $("distributeBtn").addEventListener("click", togglePump2);

        // Realtime data sync listeners
        database.ref("sensors/moisture").on("value", snap => {
          const val = snap.val();
          if ($("soilMoistureInput")) $("soilMoistureInput").textContent = val !== null ? val + " %" : "--";
        });

        database.ref("sensors/temperature").on("value", snap => {
          const val = snap.val();
          if ($("tempValue")) $("tempValue").textContent = val !== null ? val.toFixed(1) + " ¬∞C" : "--";
        });

        database.ref("sensors/humidity").on("value", snap => {
          const val = snap.val();
          if ($("humidValue")) $("humidValue").textContent = val !== null ? val + " %" : "--";
        });

        database.ref("sensors/waterLevelPercent").on("value", snap => {
          const val = snap.val();
          if ($("waterLevelInput")) $("waterLevelInput").textContent = val !== null ? val + " %" : "--";
        });

        database.ref("sensors/tankEmptyHeight").on("value", snap => {
          const val = snap.val();
          if ($("tankHeightInput")) $("tankHeightInput").textContent = val !== null ? val + " cm" : "--";
        });

        console.log("Firebase connected and listeners active.");
      });
    })();
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</body>

</html>